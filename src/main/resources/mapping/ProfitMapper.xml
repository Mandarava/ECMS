<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finance.dao.ProfitDao">
    
    <!-- <resultMap id="BaseResultMap" type="com.finance.model.pojo.FundDODO">
        <result column="id" jdbcType="Integer" property="id" />
        <result column="code" jdbcType="VARCHAR" property="fundId" />
        <result column="time" jdbcType="datetime" property="time" />
        <result column="profit" jdbcType="double" property="profit" />
        <result column="daily_gains_percent" jdbcType="double" property="dailyGainPercent" />
    </resultMap> -->
    
    <insert id="insertDailyProfit" parameterType="ProfitDO">
        INSERT INTO profit (CODE,time,profit,user_id)
        VALUES(#{code,jdbcType=VARCHAR},#{time,jdbcType=TIMESTAMP},#{profit},#{userId})
    </insert>
    
    <select id="findFundCodes" resultType="FundDO">
        select p.code ,f.name from profit p left join fund  f on p.code = f.code group by code order by max(time) desc, code
    </select>
    
    <select id="findSumProfitByDay" parameterType="string" resultType="ProfitDO">
        select DATE_FORMAT(t.time,'%Y-%m-%d') time,
          (select sum(profit) from profit p where p.code = t.code and p.TIME &lt;= t.TIME) profit
        from profit t
        where t.code = #{code}
        order by time asc
    </select>
</mapper>